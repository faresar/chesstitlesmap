<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Chess Title Map with Flags</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-y: auto;
        }
        #map-container {
            width: 100%;
            max-width: 1010px;
            height: auto;
            aspect-ratio: 1010/666;
            margin: 0 auto;
            border: 1px solid lightblue;
            background-color: lightblue;
            position: relative;
            overflow: hidden;
        }
        path {
            fill: #0F5738;
            transition: fill 0.3s;
            cursor: pointer;
        }
        path:hover {
            fill: #ff9900;
        }
        path.selected {
            fill: #ff9900; /* Highlight selected country */
        }
        .info-box {
            position: fixed;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 5px;
            padding: 5px 10px; /* Reduced padding for proportional sizing */
            pointer-events: auto; /* Allow interaction with the info box */
            display: none;
            font-family: 'Roboto', sans-serif;
            font-size: 14px; /* Adjusted font size */
            box-shadow: 0 3px 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .info-box.visible {
            display: block;
        }
        .flag {
            width: auto; /* Adjust flag size to match text */
            height: 16px; /* Same height as text */
            vertical-align: middle; /* Align flag with text */
            margin-right: 5px; /* Space between flag and text */
        }
    </style>
</head>
<body>
    <div id="map-container">
        <div class="zoom-controls">
            <button id="zoom-in">+</button>
            <button id="zoom-out">-</button>
            <button id="zoom-reset">R</button>
        </div>
    </div>
    <div class="info-box" id="info-box"></div>

    <script>
        let countryCodes = []; // Array to store country codes

        // Fetch country codes from JSON file
        fetch('Alpha3_ISO_code_List.json')
          .then(response => response.json())
          .then(data => {
              countryCodes = data; // Store country codes
              initializeMap(); // Initialize map after loading data
          })
          .catch(error => console.error("Error loading country codes:", error));

        function initializeMap() {
          const mapContainer = document.getElementById('map-container');
          const infoBox = document.getElementById("info-box");

          // Fetch SVG map and render it
          fetch('world_fide.svg')
              .then(response => response.text())
              .then(svgContent => {
                  mapContainer.innerHTML = svgContent.trim();
                  setupInteractions();
              });

          function setupInteractions() {
              const svgElement = mapContainer.querySelector('svg');
              const paths = svgElement.querySelectorAll("path");

              paths.forEach(path => {
                  path.addEventListener("mouseenter", (e) => showInfoBox(path.id, e.clientX, e.clientY));
                  path.addEventListener("mouseleave", hideInfoBox);
                  path.addEventListener("touchstart", (e) => {
                      if (e.touches.length === 1) { // Single finger touch
                          showInfoBox(path.id, e.touches[0].clientX, e.touches[0].clientY);
                      }
                  });
              });

              infoBox.addEventListener('mouseenter', () => infoBox.classList.add('visible'));
              infoBox.addEventListener('mouseleave', hideInfoBox);
          }

          function showInfoBox(countryCode, x, y) {
              if (!countryCodes.includes(countryCode)) {
                  console.warn(`Country code ${countryCode} not found in JSON.`);
                  return;
              }

              const flagUrl = `https://ratings.fide.com/svg/${countryCode}.svg`;

              infoBox.innerHTML = `
                  <img src="${flagUrl}" alt="${countryCode} Flag" class="flag">
                  <span>${countryCode}</span>
              `;
              infoBox.classList.add('visible');

              // Position above and close to pointer/touch point
              const boxHeight = infoBox.offsetHeight || 50; 
              const boxWidth = infoBox.offsetWidth || 100;

              infoBox.style.left = `${x - boxWidth / 2}px`;
              infoBox.style.top = `${y - boxHeight - 10}px`; 
          }

          function hideInfoBox() {
              infoBox.classList.remove('visible');
          }
      }
    </script>
</body>
</html>
