<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ChessTitlesMap.com | Chess titles map and statistics</title>
  <meta name="description" content="Explore chess titles by country, including Grand Master per country and other titles. Discover country-specific statistics and rankings on ChessTitlesMap.com.">
  <meta name="keywords" content="Chess titles by country, Grand Master per country, Country Grand Master, Chess titles, Chess rankings, Chess stats, Chess title map, Gransmaster, GM rank, GM ranking, IM ranking, WGM rank, WGM ranking, Map of chess countries, Most chess titles, Best chess countries">
  <meta property="og:title" content="Chess Titles by Country | ChessTitlesMap.com">
  <meta property="og:description" content="Explore chess titles by country and discover national rankings including Grand Masters, International Masters Fide Master Candidate Mastersand more on ChessTitlesMap.com.">
  <meta property="og:type" content="website">

  <!-- favicon section -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- External CSS and JS libraries -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>

  <style>
    /* General body styling */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
      width: 100%;
      overflow-y: auto;
    }
    /* Navbar styling */
    .navbar-brand {
      color: #333 !important;
      font-weight: bold;
      text-decoration: none;
    }
    .navbar-brand:hover {
      text-decoration: none;
    }
    /* UPDATED: Last updated text styling - BLUE COLOR */
    .last-updated {
      font-size: 14px;
      color: #007bff;
      text-align: center;
      margin: 10px 0;
      font-weight: 500;
    }
    .last-updated span {
      font-weight: 600;
    }
    /* Container for the map with border and background */
    #map-container {
      width: 100%;
      max-width: 1010px;
      margin: 0 auto;
      position: relative;
      border: 1px solid lightblue;
      background-color: lightblue;
      overflow: hidden;
      touch-action: none;
    }
    /* Container for the SVG map ensuring proper aspect ratio */
    #svg-container {
      width: 100%;
      height: auto;
      aspect-ratio: 1010/666;
      position: relative;
    }
    /* Zoom button controls - SAME AS ORIGINAL */
    .zoom-controls {
      position: absolute;
      top: 10px;
      left: 10px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      z-index: 1002;
    }
    .zoom-controls button {
      background-color: white;
      border: 1px solid black;
      border-radius: 4px;
      width: 28px;
      height: 28px;
      cursor: pointer;
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
      color: #007bff;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    @media (max-width: 600px) {
      .zoom-controls button {
        width: 24px;
        height: 24px;
        font-size: 12px;
      }
    }
    /* Styling for individual country paths on the map */
    path {
      fill: #548b5b;
      transition: fill 0.3s;
      cursor: pointer;
    }
    path:hover {
      fill: #ff9900;
    }
    path.selected {
      fill: #ff9900;
    }
    path.highlighted {
      fill: #b05a45;
    }
    /* UPDATED: Site description card */
    .site-description-card{
      text-align: center;
      background: linear-gradient(135deg, rgba(74, 144, 226, 0.1) 0%, rgba(53, 122, 189, 0.1) 100%);
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 3px 15px rgba(0,0,0,.15);
      font-family: 'Roboto', sans-serif;
      font-size: 16px;
      font-weight: 500;
      color: #2c3e50;
      max-width: 1010px;
      margin: 15px auto;
      border-left: 4px solid #4a90e2;
      line-height: 1.6;
    }
    @media(max-width:600px){
      .site-description-card{
        font-size: 14px;
        padding: 12px 15px;
      }
    }
    /* UPDATED: World stats box - YELLOW TITLES, WHITE NUMBERS, COLON AFTER TITLE, TOTAL INLINE */
    .world-stats {
      text-align: center;
      background: rgba(0,0,0,0.7);
      border: 1px solid black;
      padding: 10px;
      color: white;
      font-family: 'Roboto', sans-serif;
      font-size: 0.9rem;
      width: 100%;
      box-sizing: border-box;
    }
    .world-stats b {
      font-weight: bold;
      color: #ffd700;  /* Yellow for titles */
    }
    .world-stats span {
      color: white;  /* White for numbers */
    }
    .world-stats u {
      text-decoration: underline;
      color: white;
    }
    @media (max-width: 600px) {
      .world-stats {
        font-size: 0.8rem;
      }
    }
    /* Filter section container styling */
    .filter-wrapper {
      max-width: 1010px;
      margin: 20px auto;
      width: 100%;
    }
    .activity-filter {
      text-align: center;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.2);
    }
    .activity-filter label {
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 5px;
      display: block;
    }
    .activity-filter button {
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      margin-right: 5px;
      transition: background-color 0.3s;
    }
    .activity-filter button:hover {
      background-color: #f0f0f0;
    }
    .activity-filter button.active {
      background-color: #007bff;
      color: white;
    }
    /* Highlight Titles section styling */
    .highlight-titles {
      text-align: center;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.2);
      margin-top: 10px;
    }
    .highlight-titles label {
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 5px;
      display: block;
    }
    .highlight-titles-buttons {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 5px;
      justify-content: center;
    }
    .highlight-titles-buttons label {
      display: inline-block;
      padding: 5px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      background-color: white;
      transition: background-color 0.3s;
      font-size: 12px;
    }
    .highlight-titles-buttons label.active {
      background-color: #007bff;
      color: white;
      border-color: #007bff;
    }
    .highlight-titles-buttons label input {
      display: none;
    }

    /* Ad placeholder section */
    .ad-placeholder {
      text-align: center;
      background: rgba(240,240,240,0.9);
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.2);
      margin-top: 10px;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 14px;
      border: 2px dashed #ccc;
    }

    /* Title Additions Section - BLUE THEME */
    .title-additions-section {
      background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
      border-radius: 8px;
      padding: 20px;
      color: white;
      font-family: 'Roboto', sans-serif;
      max-width: 1010px;
      margin: 10px auto;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .title-additions-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .title-additions-header h3 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .title-icon {
      font-size: 1.2rem;
    }
    .year-selector {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 6px;
      padding: 6px 12px;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 8px center;
      background-size: 16px;
      padding-right: 32px;
    }
    .year-selector:hover {
      background: rgba(255,255,255,0.3);
    }
    .year-selector option {
      background: #357abd;
      color: white;
    }
    .year-totals {
      background: rgba(255,255,255,0.15);
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 10px;
    }
    .year-totals .total-item {
      text-align: center;
      min-width: 70px;
    }
    .year-totals .total-number {
      font-size: 1.8rem;
      font-weight: 700;
      display: block;
      color: #ffd700;
    }
    .year-totals .total-label {
      font-size: 0.85rem;
      opacity: 0.9;
    }
    .months-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
    }
    .month-card {
      background: rgba(255,255,255,0.15);
      border-radius: 6px;
      padding: 12px;
      transition: all 0.3s;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .month-card:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-2px);
    }
    .month-card .month-name {
      font-size: 1rem;
      font-weight: 600;
      color: #ffd700;
      margin-bottom: 8px;
    }
    .month-card .month-total {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #fff;
    }
    /* UPDATED: Numbers CENTERED between title and edge */
    .month-card .titles-breakdown {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 4px;
      font-size: 0.85rem;
    }
    .month-card .title-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .month-card .title-item .title-label {
      font-weight: 500;
      flex-shrink: 0;
      text-align: left;
    }
    .month-card .title-item .title-value {
      font-weight: 700;
      text-align: center;
      flex: 1;
    }
    .month-card .title-item .title-value.positive {
      color: #4ade80;
    }
    /* UPDATED: Lighter red for better visibility on blue */
    .month-card .title-item .title-value.negative {
      color: #fca5a5;
    }

    @media (max-width: 600px) {
      .title-additions-section {
        padding: 15px;
      }
      .title-additions-header h3 {
        font-size: 1rem;
      }
      .months-grid {
        grid-template-columns: 1fr;
      }
      .year-totals .total-number {
        font-size: 1.5rem;
      }
    }

    /* Top countries tables with rank tracking */
    .top-countries-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-evenly;
      max-width: 1010px;
      margin: 20px auto;
      gap: 20px;
    }
    .top-countries {
      flex: 1 1 45%;
      background: rgba(255,255,255,0.9);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }
    .top-countries h3 {
      text-align: center;
      font-weight: 700;
      margin-bottom: 15px;
      color: #333;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .top-countries h3 .chess-icon {
      font-size: 1.5rem;
    }
    .top-countries table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    .top-countries thead {
      background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
      color: white;
    }
    .top-countries th {
      padding: 10px 5px;
      text-align: center;
      font-weight: 600;
      font-size: 0.9rem;
      border: none;
    }
    .top-countries th:first-child {
      border-top-left-radius: 6px;
    }
    .top-countries th:last-child {
      border-top-right-radius: 6px;
    }
    .top-countries td {
      border-bottom: 1px solid #e5e7eb;
      padding: 8px 5px;
      text-align: center;
      font-size: 0.85rem;
    }
    .top-countries tbody tr:hover {
      background-color: #f3f4f6;
    }
    .top-countries tbody tr:last-child td {
      border-bottom: none;
    }
    .rank-cell {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }
    .rank-arrow {
      font-size: 0.8rem;
      font-weight: bold;
    }
    .rank-arrow.up {
      color: #22c55e;
    }
    .rank-arrow.down {
      color: #ef4444;
    }
    .rank-arrow.new {
      color: #3b82f6;
      font-size: 0.7rem;
    }
    .flag {
      height: 1.2em;
      width: auto;
      vertical-align: middle;
      margin-right: 5px;
    }

    /* Info-box styling for country details on hover/touch */
    .info-box {
      position: fixed;
      background: rgba(255,255,255,0.95);
      border-radius: 5px;
      padding: 5px 10px;
      pointer-events: auto;
      display: none;
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    .info-box.visible {
      display: block;
    }
    /* Footer styling with Data Privacy link positioned to the right */
    footer {
      background-color: #333;
      color: #fff;
      text-align: center;
      padding: 15px;
      margin-top: 20px;
      font-size: 14px;
      position: relative;
    }
    footer .data-privacy {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
    }
    footer .data-privacy a {
      color: #007bff;
      text-decoration: none;
    }
    footer .data-privacy a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html"><h1 style="display:inline; font-size:inherit; font-weight:inherit; margin:0;">World FIDE Chess Titles</h1></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
              aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="how-to-get-title.html" target="_blank">How to Get Title</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://ratings.fide.com/" target="_blank">FIDE Ratings</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- UPDATED: Last Updated - BLUE COLOR -->
  <div class="last-updated">
    Last updated: <span id="last-updated-date">January 31, 2026</span>
  </div>

  <!-- UPDATED: Original sentence restored -->
  <div class="site-description-card">
    <p style="margin: 0;">
      Check out the number of titled chess players in each country and explore which nations lead the world in Grandmasters, International Masters and other FIDE titles.
    </p>
  </div>

  <!-- Map Container showing world stats and SVG map -->
  <div id="map-container">
    <!-- UPDATED: Colon after World Stats, total inline -->
    <div class="world-stats" id="world-stats">
      <div><u><b>World Stats: <span id="total-count-inline">0</span> total titles</b></u></div>
      <div>
         <b>GM:</b> <span id="gm-count">0</span>&emsp;
         <b>IM:</b> <span id="im-count">0</span>&emsp;
         <b>FM:</b> <span id="fm-count">0</span>&emsp;
         <b>CM:</b> <span id="cm-count">0</span>
      </div>
      <div>
         <b>WGM:</b> <span id="wgm-count">0</span>&emsp;
         <b>WIM:</b> <span id="wim-count">0</span>&emsp;
         <b>WFM:</b> <span id="wfm-count">0</span>&emsp;
         <b>WCM:</b> <span id="wcm-count">0</span>
      </div>
    </div>
    <div id="svg-container">
      <div class="zoom-controls">
         <button id="zoom-in">+</button>
         <button id="zoom-out">-</button>
         <button id="zoom-reset">R</button>
      </div>
    </div>
  </div>

  <div class="filter-wrapper">
    <div class="activity-filter">
      <label>Player Activity Filter:</label>
      <button id="filter-both" class="active" title="Players who have played rated tournament recently including inactive players">Both</button>
      <button id="filter-active" title="Players who have played rated tournament recently">Active</button>
      <button id="filter-inactive" title="Inactive players that have not played rated tournament recently">Inactive</button>
    </div>

    <div class="highlight-titles">
      <label>Highlight Titles on the Map:</label>
      <div class="highlight-titles-buttons">
        <label for="highlight-none" id="label-highlight-none" class="active">None/Reset
          <input type="checkbox" id="highlight-none" name="highlight" value="none" checked>
        </label>
        <label for="highlight-gm" id="label-highlight-gm">GM
          <input type="checkbox" id="highlight-gm" name="highlight" value="GM">
        </label>
        <label for="highlight-im" id="label-highlight-im">IM
          <input type="checkbox" id="highlight-im" name="highlight" value="IM">
        </label>
        <label for="highlight-fm" id="label-highlight-fm">FM
          <input type="checkbox" id="highlight-fm" name="highlight" value="FM">
        </label>
        <label for="highlight-cm" id="label-highlight-cm">CM
          <input type="checkbox" id="highlight-cm" name="highlight" value="CM">
        </label>
        <label for="highlight-wgm" id="label-highlight-wgm">WGM
          <input type="checkbox" id="highlight-wgm" name="highlight" value="WGM">
        </label>
        <label for="highlight-wim" id="label-highlight-wim">WIM
          <input type="checkbox" id="highlight-wim" name="highlight" value="WIM">
        </label>
        <label for="highlight-wfm" id="label-highlight-wfm">WFM
          <input type="checkbox" id="highlight-wfm" name="highlight" value="WFM">
        </label>
        <label for="highlight-wcm" id="label-highlight-wcm">WCM
          <input type="checkbox" id="highlight-wcm" name="highlight" value="WCM">
        </label>
      </div>
    </div>

    <div class="ad-placeholder">
      Advertisement Space
    </div>

    <!-- Title Additions Section -->
    <div class="title-additions-section" id="title-additions-section">
      <div class="title-additions-header">
        <h3><span class="title-icon">ðŸ“Š</span> New Title Additions</h3>
        <select class="year-selector" id="year-selector">
          <option value="2026" selected>2026</option>
          <option value="2025">2025</option>
        </select>
      </div>

      <div class="year-totals" id="year-totals">
      </div>

      <div class="months-grid" id="months-grid">
      </div>
    </div>

    <div class="top-countries-container">
      <div class="top-countries" id="top-countries-men">
        <h3><span class="chess-icon">â™”</span> Top Countries - Open</h3>
        <table>
          <thead>
            <tr>
              <th>Rank</th>
              <th>Country</th>
              <th>GM</th>
              <th>IM</th>
              <th>FM</th>
              <th>CM</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <div class="top-countries" id="top-countries-women">
        <h3><span class="chess-icon">â™•</span> Top Countries - Women</h3>
        <table>
          <thead>
            <tr>
              <th>Rank</th>
              <th>Country</th>
              <th>WGM</th>
              <th>WIM</th>
              <th>WFM</th>
              <th>WCM</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <footer>
    Report any bug or inconsistencies to <a href="mailto:tens.gusto-0a@icloud.com" style="color:#007bff;">tens.gusto-0a@icloud.com</a>
    <div class="data-privacy"><a href="data_privacy.html" target="_blank">Privacy Policy</a></div>
  </footer>

  <script>
    "use strict";

    // 2025 data - WITHOUT JANUARY (not adding fake data)
    const data2025 = {
      "months": [
        {"month": "FEB", "total": 131, "GM": 0, "IM": 1, "FM": 30, "CM": 64, "WGM": 0, "WIM": 1, "WFM": 17, "WCM": 18},
        {"month": "MAR", "total": 97, "GM": 0, "IM": 0, "FM": 34, "CM": 42, "WGM": 1, "WIM": 0, "WFM": 14, "WCM": 6},
        {"month": "APR", "total": 110, "GM": 12, "IM": 31, "FM": -13, "CM": 60, "WGM": 0, "WIM": 4, "WFM": 6, "WCM": 10},
        {"month": "MAY", "total": 111, "GM": 0, "IM": 0, "FM": 49, "CM": 42, "WGM": 0, "WIM": 1, "WFM": 7, "WCM": 12},
        {"month": "JUN", "total": 82, "GM": -4, "IM": 1, "FM": 25, "CM": 43, "WGM": 0, "WIM": 2, "WFM": 4, "WCM": 11},
        {"month": "JUL", "total": 98, "GM": 4, "IM": 2, "FM": 26, "CM": 41, "WGM": 0, "WIM": 7, "WFM": 7, "WCM": 11},
        {"month": "AUG", "total": 125, "GM": 8, "IM": 34, "FM": 16, "CM": 58, "WGM": 0, "WIM": 8, "WFM": 5, "WCM": -4},
        {"month": "SEP", "total": 142, "GM": 1, "IM": -1, "FM": 44, "CM": 58, "WGM": 0, "WIM": 7, "WFM": 16, "WCM": 17},
        {"month": "OCT", "total": 87, "GM": -4, "IM": -5, "FM": 36, "CM": 37, "WGM": 0, "WIM": 1, "WFM": 15, "WCM": 7},
        {"month": "NOV", "total": 155, "GM": 11, "IM": 23, "FM": 31, "CM": 46, "WGM": 1, "WIM": 8, "WFM": 16, "WCM": 19},
        {"month": "DEC", "total": 117, "GM": 5, "IM": 9, "FM": 39, "CM": 41, "WGM": 3, "WIM": 3, "WFM": 0, "WCM": 17}
      ],
      "yearly_totals": {"GM": 33, "IM": 95, "FM": 317, "CM": 532, "WGM": 5, "WIM": 42, "WFM": 107, "WCM": 124},
      "total": 1255
    };

    let titledPlayersData = {};
    let previousRankings = {};
    let currentFilter = 'both';
    let currentHighlight = 'none';
    let lastUpdatedDate = '';
    let monthlyChanges = [];

    function renderTitleAdditions(year) {
      const yearTotalsDiv = document.getElementById('year-totals');
      const monthsGridDiv = document.getElementById('months-grid');

      if (year === '2025') {
        yearTotalsDiv.innerHTML = `
          <div class="total-item">
            <span class="total-number">${data2025.total}</span>
            <span class="total-label">Total</span>
          </div>
          <div class="total-item">
            <span class="total-number">${data2025.yearly_totals.GM}</span>
            <span class="total-label">GM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${data2025.yearly_totals.IM}</span>
            <span class="total-label">IM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${data2025.yearly_totals.FM}</span>
            <span class="total-label">FM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${data2025.yearly_totals.CM}</span>
            <span class="total-label">CM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${data2025.yearly_totals.WGM}</span>
            <span class="total-label">WGM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${data2025.yearly_totals.WIM}</span>
            <span class="total-label">WIM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${data2025.yearly_totals.WFM}</span>
            <span class="total-label">WFM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${data2025.yearly_totals.WCM}</span>
            <span class="total-label">WCM</span>
          </div>
        `;

        monthsGridDiv.innerHTML = data2025.months.map(month => `
          <div class="month-card">
            <div class="month-name">${month.month} 2025</div>
            <div class="month-total">Total: ${month.total}</div>
            <div class="titles-breakdown">
              <div class="title-item">
                <span class="title-label">GM:</span>
                <span class="title-value ${month.GM > 0 ? 'positive' : month.GM < 0 ? 'negative' : ''}">${month.GM > 0 ? '+' : ''}${month.GM}</span>
              </div>
              <div class="title-item">
                <span class="title-label">WGM:</span>
                <span class="title-value ${month.WGM > 0 ? 'positive' : month.WGM < 0 ? 'negative' : ''}">${month.WGM > 0 ? '+' : ''}${month.WGM}</span>
              </div>
              <div class="title-item">
                <span class="title-label">IM:</span>
                <span class="title-value ${month.IM > 0 ? 'positive' : month.IM < 0 ? 'negative' : ''}">${month.IM > 0 ? '+' : ''}${month.IM}</span>
              </div>
              <div class="title-item">
                <span class="title-label">WIM:</span>
                <span class="title-value ${month.WIM > 0 ? 'positive' : month.WIM < 0 ? 'negative' : ''}">${month.WIM > 0 ? '+' : ''}${month.WIM}</span>
              </div>
              <div class="title-item">
                <span class="title-label">FM:</span>
                <span class="title-value ${month.FM > 0 ? 'positive' : month.FM < 0 ? 'negative' : ''}">${month.FM > 0 ? '+' : ''}${month.FM}</span>
              </div>
              <div class="title-item">
                <span class="title-label">WFM:</span>
                <span class="title-value ${month.WFM > 0 ? 'positive' : month.WFM < 0 ? 'negative' : ''}">${month.WFM > 0 ? '+' : ''}${month.WFM}</span>
              </div>
              <div class="title-item">
                <span class="title-label">CM:</span>
                <span class="title-value ${month.CM > 0 ? 'positive' : month.CM < 0 ? 'negative' : ''}">${month.CM > 0 ? '+' : ''}${month.CM}</span>
              </div>
              <div class="title-item">
                <span class="title-label">WCM:</span>
                <span class="title-value ${month.WCM > 0 ? 'positive' : month.WCM < 0 ? 'negative' : ''}">${month.WCM > 0 ? '+' : ''}${month.WCM}</span>
              </div>
            </div>
          </div>
        `).join('');

      } else if (year === '2026' && monthlyChanges && monthlyChanges.length > 0) {
        const yearlyTotals = {
          total: 0,
          GM: 0, IM: 0, FM: 0, CM: 0,
          WGM: 0, WIM: 0, WFM: 0, WCM: 0
        };

        monthlyChanges.forEach(month => {
          yearlyTotals.total += month.changes.total;
          ['GM', 'IM', 'FM', 'CM', 'WGM', 'WIM', 'WFM', 'WCM'].forEach(title => {
            yearlyTotals[title] += month.changes[title] || 0;
          });
        });

        yearTotalsDiv.innerHTML = `
          <div class="total-item">
            <span class="total-number">${yearlyTotals.total}</span>
            <span class="total-label">Total</span>
          </div>
          <div class="total-item">
            <span class="total-number">${yearlyTotals.GM}</span>
            <span class="total-label">GM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${yearlyTotals.IM}</span>
            <span class="total-label">IM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${yearlyTotals.FM}</span>
            <span class="total-label">FM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${yearlyTotals.CM}</span>
            <span class="total-label">CM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${yearlyTotals.WGM}</span>
            <span class="total-label">WGM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${yearlyTotals.WIM}</span>
            <span class="total-label">WIM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${yearlyTotals.WFM}</span>
            <span class="total-label">WFM</span>
          </div>
          <div class="total-item">
            <span class="total-number">${yearlyTotals.WCM}</span>
            <span class="total-label">WCM</span>
          </div>
        `;

        monthsGridDiv.innerHTML = monthlyChanges.map(month => {
          const changes = month.changes;
          return `
            <div class="month-card">
              <div class="month-name">${month.month} 2026</div>
              <div class="month-total">Total: ${changes.total}</div>
              <div class="titles-breakdown">
                <div class="title-item">
                  <span class="title-label">GM:</span>
                  <span class="title-value ${changes.GM > 0 ? 'positive' : changes.GM < 0 ? 'negative' : ''}">${changes.GM > 0 ? '+' : ''}${changes.GM}</span>
                </div>
                <div class="title-item">
                  <span class="title-label">WGM:</span>
                  <span class="title-value ${changes.WGM > 0 ? 'positive' : changes.WGM < 0 ? 'negative' : ''}">${changes.WGM > 0 ? '+' : ''}${changes.WGM}</span>
                </div>
                <div class="title-item">
                  <span class="title-label">IM:</span>
                  <span class="title-value ${changes.IM > 0 ? 'positive' : changes.IM < 0 ? 'negative' : ''}">${changes.IM > 0 ? '+' : ''}${changes.IM}</span>
                </div>
                <div class="title-item">
                  <span class="title-label">WIM:</span>
                  <span class="title-value ${changes.WIM > 0 ? 'positive' : changes.WIM < 0 ? 'negative' : ''}">${changes.WIM > 0 ? '+' : ''}${changes.WIM}</span>
                </div>
                <div class="title-item">
                  <span class="title-label">FM:</span>
                  <span class="title-value ${changes.FM > 0 ? 'positive' : changes.FM < 0 ? 'negative' : ''}">${changes.FM > 0 ? '+' : ''}${changes.FM}</span>
                </div>
                <div class="title-item">
                  <span class="title-label">WFM:</span>
                  <span class="title-value ${changes.WFM > 0 ? 'positive' : changes.WFM < 0 ? 'negative' : ''}">${changes.WFM > 0 ? '+' : ''}${changes.WFM}</span>
                </div>
                <div class="title-item">
                  <span class="title-label">CM:</span>
                  <span class="title-value ${changes.CM > 0 ? 'positive' : changes.CM < 0 ? 'negative' : ''}">${changes.CM > 0 ? '+' : ''}${changes.CM}</span>
                </div>
                <div class="title-item">
                  <span class="title-label">WCM:</span>
                  <span class="title-value ${changes.WCM > 0 ? 'positive' : changes.WCM < 0 ? 'negative' : ''}">${changes.WCM > 0 ? '+' : ''}${changes.WCM}</span>
                </div>
              </div>
            </div>
          `;
        }).join('');
      } else {
        yearTotalsDiv.innerHTML = '<div class="total-item"><span class="total-label">No data available for 2026 yet</span></div>';
        monthsGridDiv.innerHTML = '';
      }
    }

    document.getElementById('year-selector').addEventListener('change', (e) => {
      renderTitleAdditions(e.target.value);
    });

    function updateWorldwideNumbers() {
      let gmCount = 0, wgmCount = 0, imCount = 0, wimCount = 0, fmCount = 0, wfmCount = 0, cmCount = 0, wcmCount = 0;
      Object.values(titledPlayersData).forEach(countryData => {
        let source = currentFilter === 'active' ? countryData.Active 
                     : currentFilter === 'inactive' ? countryData.Inactive 
                     : countryData.Total;
        gmCount += source?.GM || 0;
        wgmCount += source?.WGM || 0;
        imCount += source?.IM || 0;
        wimCount += source?.WIM || 0;
        fmCount += source?.FM || 0;
        wfmCount += source?.WFM || 0;
        cmCount += source?.CM || 0;
        wcmCount += source?.WCM || 0;
      });
      document.getElementById('gm-count').textContent = gmCount;
      document.getElementById('wgm-count').textContent = wgmCount;
      document.getElementById('im-count').textContent = imCount;
      document.getElementById('wim-count').textContent = wimCount;
      document.getElementById('fm-count').textContent = fmCount;
      document.getElementById('wfm-count').textContent = wfmCount;
      document.getElementById('cm-count').textContent = cmCount;
      document.getElementById('wcm-count').textContent = wcmCount;

      const totalCount = gmCount + wgmCount + imCount + wimCount + fmCount + wfmCount + cmCount + wcmCount;
      document.getElementById('total-count-inline').textContent = totalCount;
    }

    function getRankChangeArrow(currentRank, previousRank) {
      if (!previousRank || previousRank === 0) {
        return '';
      }
      const diff = previousRank - currentRank;
      if (diff > 0) {
        return `<span class="rank-arrow up">â–²${diff}</span>`;
      } else if (diff < 0) {
        return `<span class="rank-arrow down">â–¼${Math.abs(diff)}</span>`;
      }
      return '';
    }

    function updateTopCountries() {
      let menData = [];
      let womenData = [];
      Object.keys(titledPlayersData).forEach(countryCode => {
        const data = titledPlayersData[countryCode];
        const source = currentFilter === 'active' ? data.Active 
                     : currentFilter === 'inactive' ? data.Inactive 
                     : data.Total;
        menData.push({ code: countryCode, GM: source?.GM || 0, IM: source?.IM || 0, FM: source?.FM || 0, CM: source?.CM || 0 });
        womenData.push({ code: countryCode, WGM: source?.WGM || 0, WIM: source?.WIM || 0, WFM: source?.WFM || 0, WCM: source?.WCM || 0 });
      });
      menData.sort((a, b) => b.GM - a.GM || b.IM - a.IM || b.FM - a.FM || b.CM - a.CM);
      womenData.sort((a, b) => b.WGM - a.WGM || b.WIM - a.WIM || b.WFM - a.WFM || b.WCM - a.WCM);

      const menTbody = document.querySelector('#top-countries-men tbody');
      menTbody.innerHTML = '';
      menData.forEach((item, index) => {
        if (item.GM || item.IM || item.FM || item.CM) {
          const currentRank = index + 1;
          const previousRank = previousRankings.men ? previousRankings.men[item.code] : 0;
          const rankArrow = getRankChangeArrow(currentRank, previousRank);
          const flagUrl = (item.code === "FID") ? "Fidelogo.png" : `https://ratings.fide.com/svg/${item.code}.svg`;
          const tr = document.createElement('tr');
          tr.innerHTML = `<td><div class="rank-cell">${currentRank}${rankArrow}</div></td>
                          <td><img src="${flagUrl}" class="flag" alt="${item.code} Flag"> <a href="https://ratings.fide.com/rankings.phtml?country=${item.code}" target="_blank">${item.code}</a></td>
                          <td>${item.GM}</td>
                          <td>${item.IM}</td>
                          <td>${item.FM}</td>
                          <td>${item.CM}</td>`;
          menTbody.appendChild(tr);
        }
      });

      const womenTbody = document.querySelector('#top-countries-women tbody');
      womenTbody.innerHTML = '';
      womenData.forEach((item, index) => {
        if (item.WGM || item.WIM || item.WFM || item.WCM) {
          const currentRank = index + 1;
          const previousRank = previousRankings.women ? previousRankings.women[item.code] : 0;
          const rankArrow = getRankChangeArrow(currentRank, previousRank);
          const flagUrl = (item.code === "FID") ? "Fidelogo.png" : `https://ratings.fide.com/svg/${item.code}.svg`;
          const tr = document.createElement('tr');
          tr.innerHTML = `<td><div class="rank-cell">${currentRank}${rankArrow}</div></td>
                          <td><img src="${flagUrl}" class="flag" alt="${item.code} Flag"> <a href="https://ratings.fide.com/rankings.phtml?country=${item.code}" target="_blank">${item.code}</a></td>
                          <td>${item.WGM}</td>
                          <td>${item.WIM}</td>
                          <td>${item.WFM}</td>
                          <td>${item.WCM}</td>`;
          womenTbody.appendChild(tr);
        }
      });
    }

    fetch('titled_players_by_country.json')
      .then(response => response.json())
      .then(data => {
        data.titled_players_by_country.forEach(item => {
          titledPlayersData[item.Country] = item;
        });

        if (data.metadata && data.metadata.last_updated) {
          lastUpdatedDate = data.metadata.last_updated;
          document.getElementById('last-updated-date').textContent = lastUpdatedDate;
        }

        if (data.metadata && data.metadata.monthly_changes) {
          monthlyChanges = data.metadata.monthly_changes;
        }

        if (data.metadata && data.metadata.previous_rankings) {
          previousRankings = data.metadata.previous_rankings;
        }

        updateWorldwideNumbers();
        updateTopCountries();
        renderTitleAdditions('2026');
      })
      .catch(error => { 
        console.error('Error fetching titled players data:', error);
        document.getElementById('last-updated-date').textContent = 'January 31, 2026';
      });

    fetch('world_fide.svg')
      .then(response => response.text())
      .then(svgContent => {
        document.getElementById('svg-container').innerHTML += svgContent.trim();
        initializeMap();
      });

    function initializeMap() {
      const svgContainer = document.getElementById('svg-container');
      const svgElement = svgContainer.querySelector('svg');
      let infoBox = document.getElementById("info-box");
      if (!infoBox) {
        infoBox = document.createElement("div");
        infoBox.id = "info-box";
        infoBox.className = "info-box";
        document.body.appendChild(infoBox);
      }
      let selectedCountry = null;
      const panZoom = svgPanZoom(svgElement, {
        zoomEnabled: true,
        controlIconsEnabled: false,
        fit: true,
        center: true,
        minZoom: 1,
        maxZoom: 72,
        zoomScaleSensitivity: 0.2,
      });
      panZoom.disableDblClickZoom();
      document.getElementById("zoom-in").addEventListener("click", () => panZoom.zoomIn());
      document.getElementById("zoom-out").addEventListener("click", () => panZoom.zoomOut());
      document.getElementById("zoom-reset").addEventListener("click", () => {
        panZoom.reset();
        panZoom.resize().fit().center();
      });
      document.getElementById("filter-both").addEventListener("click", () => {
        currentFilter = 'both';
        updateFilterButtons();
        updateHighlight();
        updateWorldwideNumbers();
        updateTopCountries();
      });
      document.getElementById("filter-active").addEventListener("click", () => {
        currentFilter = 'active';
        updateFilterButtons();
        updateHighlight();
        updateWorldwideNumbers();
        updateTopCountries();
      });
      document.getElementById("filter-inactive").addEventListener("click", () => {
        currentFilter = 'inactive';
        updateFilterButtons();
        updateHighlight();
        updateWorldwideNumbers();
        updateTopCountries();
      });
      function updateFilterButtons() {
        document.getElementById("filter-both").classList.toggle("active", currentFilter === 'both');
        document.getElementById("filter-active").classList.toggle("active", currentFilter === 'active');
        document.getElementById("filter-inactive").classList.toggle("active", currentFilter === 'inactive');
      }
      const highlightCheckboxes = document.querySelectorAll('.highlight-titles-buttons input[type="checkbox"]');
      highlightCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
          document.querySelectorAll('.highlight-titles-buttons label').forEach(label => label.classList.remove('active'));
          if (checkbox.checked) {
            checkbox.parentElement.classList.add('active');
            currentHighlight = checkbox.value;
            highlightCheckboxes.forEach(cb => {
              if (cb !== checkbox) {
                cb.checked = false;
                cb.parentElement.classList.remove('active');
              }
            });
          } else {
            currentHighlight = 'none';
            document.getElementById("highlight-none").checked = true;
            document.getElementById("label-highlight-none").classList.add('active');
          }
          updateHighlight();
        });
      });
      function updateHighlight() {
        const paths = svgElement.querySelectorAll("path");
        paths.forEach(path => {
          path.classList.remove('highlighted');
          const countryCode = path.id;
          const countryData = titledPlayersData[countryCode] || {};
          if (currentHighlight !== 'none') {
            let source = currentFilter === 'active' ? countryData.Active 
                       : currentFilter === 'inactive' ? countryData.Inactive 
                       : countryData.Total;
            const count = source?.[currentHighlight] || 0;
            if (count > 0) path.classList.add('highlighted');
          }
        });
      }
      const paths = svgElement.querySelectorAll("path");
      paths.forEach(path => {
        path.addEventListener("mouseenter", (e) => {
          if (!selectedCountry) showInfoBox(path.id, e.clientX, e.clientY);
        });
        path.addEventListener("mouseleave", () => {
          if (!selectedCountry && !infoBox.matches(':hover')) hideInfoBox();
        });
        path.addEventListener("touchstart", (e) => {
          if (e.touches.length === 1) {
            if (selectedCountry)
              document.querySelector(`path[id="${selectedCountry}"]`).classList.remove('selected');
            selectedCountry = path.id;
            path.classList.add('selected');
            showInfoBox(path.id, e.touches[0].clientX, e.touches[0].clientY);
          }
        });
      });
      infoBox.addEventListener('mouseenter', () => { infoBox.classList.add('visible'); });
      infoBox.addEventListener('mouseleave', () => { if (!selectedCountry) hideInfoBox(); });
      document.addEventListener("touchstart", (e) => {
        if (!infoBox.contains(e.target) && !Array.from(paths).some(path => path.contains(e.target))) hideInfoBox();
      });
      window.addEventListener('resize', () => { panZoom.resize().fit().center(); });
      let initialDistance = null, initialScale = 1;
      svgContainer.addEventListener("touchstart", (e) => {
        if (e.touches.length === 2) {
          initialDistance = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
          initialScale = panZoom.getZoom();
        }
      });
      svgContainer.addEventListener("touchmove", (e) => {
        if (e.touches.length === 2 && initialDistance !== null) {
          e.preventDefault();
          const currentDistance = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
          const scale = (currentDistance / initialDistance) * initialScale;
          const centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
          const centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
          const svgPoint = svgElement.createSVGPoint();
          svgPoint.x = centerX;
          svgPoint.y = centerY;
          const transformedPoint = svgPoint.matrixTransform(svgElement.getScreenCTM().inverse());
          panZoom.zoomAtPoint(scale, transformedPoint);
        }
      });
      svgContainer.addEventListener("touchend", () => { initialDistance = null; });

      function showInfoBox(countryCode, x, y) {
        const flagUrl = (countryCode === "FID") ? "Fidelogo.png" : `https://ratings.fide.com/svg/${countryCode}.svg`;
        const countryData = titledPlayersData[countryCode] || {};
        let source = currentFilter === 'active' ? countryData.Active 
                   : currentFilter === 'inactive' ? countryData.Inactive 
                   : countryData.Total;
        infoBox.innerHTML = `
          <img src="${flagUrl}" alt="${countryCode} Flag" class="flag">
          <a href="https://ratings.fide.com/rankings.phtml?country=${countryCode}" target="_blank">${countryCode}</a><br>
          <b>GM:</b> ${source?.GM || 0} | <b>WGM:</b> ${source?.WGM || 0}<br>
          <b>IM:</b> ${source?.IM || 0} | <b>WIM:</b> ${source?.WIM || 0}<br>
          <b>FM:</b> ${source?.FM || 0} | <b>WFM:</b> ${source?.WFM || 0}<br>
          <b>CM:</b> ${source?.CM || 0} | <b>WCM:</b> ${source?.WCM || 0}
        `;
        infoBox.classList.add('visible');
        const boxHeight = infoBox.offsetHeight || 50;
        const boxWidth = infoBox.offsetWidth || 100;
        infoBox.style.left = `${x - boxWidth/2}px`;
        infoBox.style.top = `${y - boxHeight}px`;
      }
      function hideInfoBox() {
        if (selectedCountry) {
          document.querySelector(`path[id="${selectedCountry}"]`).classList.remove('selected');
          selectedCountry = null;
        }
        infoBox.classList.remove('visible');
      }
    }
  </script>

  <div class="info-box" id="info-box"></div>
  <script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
</body>
</html>
